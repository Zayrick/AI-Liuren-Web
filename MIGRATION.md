# Cloudflare Pages åˆ° Workers è¿ç§»è¯´æ˜

## è¿ç§»æ¦‚è¿°

æœ¬é¡¹ç›®å·²ä» **Cloudflare Pages Functions** æ¶æ„è¿ç§»åˆ° **Cloudflare Workers** æ¶æ„ã€‚

## ä¸»è¦å˜æ›´

### 1. æ¶æ„å˜æ›´
- **ä¹‹å‰**: Cloudflare Pages Functions (`functions/divination.js`)
- **ç°åœ¨**: Cloudflare Worker (`worker.js`)

### 2. é…ç½®æ–‡ä»¶å˜æ›´
- `wrangler.toml`: ç§»é™¤ Pages é…ç½®ï¼Œæ·»åŠ  Worker é…ç½®å’Œé™æ€èµ„äº§ç»‘å®š
- `package.json`: æ›´æ–°è„šæœ¬å‘½ä»¤ï¼Œæ”¯æŒ Worker å¼€å‘å’Œéƒ¨ç½²

### 3. æ–‡ä»¶ç»“æ„å˜æ›´
```
é¡¹ç›®æ ¹ç›®å½•/
â”œâ”€â”€ worker.js              # ğŸ†• Worker ä¸»å…¥å£æ–‡ä»¶
â”œâ”€â”€ wrangler.toml           # ğŸ”§ æ›´æ–°ä¸º Worker é…ç½®
â”œâ”€â”€ package.json            # ğŸ”§ æ›´æ–°è„šæœ¬å‘½ä»¤
â”œâ”€â”€ functions/              # âš ï¸  ä¿ç•™ä½†ä¸å†ä½¿ç”¨
â”‚   â””â”€â”€ divination.js
â”œâ”€â”€ lib/                    # âœ… ç»§ç»­ä½¿ç”¨çš„ä¸šåŠ¡é€»è¾‘æ¨¡å—
â”‚   â”œâ”€â”€ hexagram.js
â”‚   â”œâ”€â”€ time.js
â”‚   â””â”€â”€ ganzhi.js
â”œâ”€â”€ assets/                 # âœ… é™æ€èµ„äº§ï¼ˆCSSã€JSï¼‰
â”œâ”€â”€ index.html              # âœ… ä¸»é¡µé¢
â””â”€â”€ ...å…¶ä»–é™æ€æ–‡ä»¶
```

### 4. API è·¯å¾„å˜æ›´
- **ä¹‹å‰**: `/divination`ï¼ˆPages Functions è‡ªåŠ¨è·¯ç”±ï¼‰
- **ç°åœ¨**: `/api/divination`ï¼ˆWorker ä¸­æ˜ç¡®å®šä¹‰ï¼‰

## éƒ¨ç½²æŒ‡ä»¤

### å¼€å‘ç¯å¢ƒ
```bash
# æœ¬åœ°å¼€å‘ï¼ˆä½¿ç”¨æ¨¡æ‹Ÿç¯å¢ƒï¼‰
npm run dev

# è¿œç¨‹å¼€å‘ï¼ˆä½¿ç”¨ Cloudflare å¼€å‘ç¯å¢ƒï¼‰
npm run dev:remote
```

### ç”Ÿäº§éƒ¨ç½²
```bash
npm run deploy
```

## ç¯å¢ƒå˜é‡é…ç½®

åœ¨ `wrangler.toml` ä¸­é…ç½®æˆ–ä½¿ç”¨ Cloudflare Dashboardï¼š

```toml
[vars]
API_KEY = "your-ai-api-key"
MODEL = "gpt-4o"
ENDPOINT = "https://api.openai.com/v1/chat/completions"
SYSTEM_PROMPT = "ä½ çš„ç³»ç»Ÿæç¤ºè¯"
```

## ä¼˜åŠ¿

1. **æ›´å¥½çš„æ€§èƒ½**: Worker å¯åŠ¨æ›´å¿«ï¼Œå“åº”æ—¶é—´æ›´çŸ­
2. **æ›´çµæ´»çš„è·¯ç”±**: å¯ä»¥è‡ªå®šä¹‰å¤æ‚çš„è·¯ç”±é€»è¾‘
3. **ç»Ÿä¸€éƒ¨ç½²**: é™æ€èµ„äº§å’Œ API ç»Ÿä¸€éƒ¨ç½²ï¼Œæ— éœ€åˆ†ç¦»
4. **æ›´å¥½çš„é”™è¯¯å¤„ç†**: ç»Ÿä¸€çš„é”™è¯¯å¤„ç†å’Œ CORS æ”¯æŒ

## æ³¨æ„äº‹é¡¹

1. ç¡®ä¿ç¯å¢ƒå˜é‡æ­£ç¡®é…ç½®
2. é™æ€èµ„äº§é€šè¿‡ Worker æœåŠ¡ï¼Œå¯èƒ½å½±å“ç¼“å­˜ç­–ç•¥
3. å¼€å‘æ—¶ä½¿ç”¨ `npm run dev` è¿›è¡Œæœ¬åœ°æµ‹è¯•

## è¿ç§»éªŒè¯

éƒ¨ç½²åéªŒè¯ä»¥ä¸‹åŠŸèƒ½ï¼š
- [ ] ä¸»é¡µé¢èƒ½æ­£å¸¸åŠ è½½
- [ ] é™æ€èµ„äº§ï¼ˆCSSã€JSã€å›¾ç‰‡ï¼‰èƒ½æ­£å¸¸åŠ è½½
- [ ] API æ¥å£ `/api/divination` èƒ½æ­£å¸¸å“åº”
- [ ] SSE æµå¼å“åº”æ­£å¸¸å·¥ä½œ
- [ ] AI è®¾ç½®é¢æ¿åŠŸèƒ½æ­£å¸¸ 